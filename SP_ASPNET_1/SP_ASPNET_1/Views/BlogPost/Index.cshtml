@using SP_ASPNET_1.BusinessLogic
@using SP_ASPNET_1.Models


@{ Layout = "~/Views/Shared/Blog/_BlogLayout.cshtml"; }

@if (Model.BlogPosts != null)
{
<ul class="Posts__Featured">
    @foreach (BlogPost post in Model.BlogPosts)
    {
<li class="Posts__Item">
    @* <div class="card mb-3" style="max-width: 540px;">
                <div class="row no-gutters">
                    <div class="col-md-4">
                        <img src="@Html.AttributeEncode(Constants.POST_IMAGE_PREFIX + post.ImageUrl)" class="card-img" alt="post image preview">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">@post.Title</h5>
                            <p class="card-text">@post.Content.Substring(0, 200)...</p>
                            <button onClick="location.href='@Url.Action("SinglePost", new { id = @post.BlogPostID})'" class="btn btn-primary">read more</button>
                            @if (@post.Likes == null)
                            {
                                using (Ajax.BeginForm("Like", "BlogPost", new { userId = post.FK_UserId, postId = post.BlogPostID },
                                          new AjaxOptions() { HttpMethod = "POST",UpdateTargetId="likes-number" , InsertionMode = InsertionMode.Replace }, new { @class = "btn btn-success" }))
                                {

        <button onClick="location.href='@Url.Action("SinglePost", new { id = @post.BlogPostID})'" class="btn btn-success"> <p id="likes-number">0</p> Like</button>} }


        else
        {
        <button onClick="location.href='@Url.Action("SinglePost", new { id = @post.BlogPostID})'" class="btn btn-success">@post.Likes.ToList().Count Like</button>}

                            <p class="card-text"><small class="text-muted">By @post.User on @post.DateTime.ToString(Constants.DISPLAY_DATETIME_FORMAT)</small></p>
                        </div>
                    </div>
                </div>
            </div>*@

    @Html.Partial("Post", post)
</li>}
    <li>
        <button class="c-btn">load more</button>
    </li>

</ul> }
else
{
<h1>There are no blog posts :-(</h1>}


@section Scripts

   {
    <script src="~/Scripts/jquery-3.5.1.min.js"></script>

    <script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
    <script src="@Url.Content("~/js/BlogPost.js")" type="text/javascript"></script>
}